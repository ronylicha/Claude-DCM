<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="760" viewBox="0 0 1200 760" role="img" aria-label="Claude Code hooks flow">
  <defs>
    <style>
      .title { font: 700 30px "Inter", "Segoe UI", Arial, sans-serif; fill: #0f172a; }
      .label { font: 600 18px "Inter", "Segoe UI", Arial, sans-serif; fill: #0f172a; }
      .sub { font: 400 14px "Inter", "Segoe UI", Arial, sans-serif; fill: #334155; }
      .box { fill: #f8fafc; stroke: #94a3b8; stroke-width: 2; rx: 12; }
      .arrow { stroke: #64748b; stroke-width: 2; marker-end: url(#arrow); }
    </style>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#64748b" />
    </marker>
  </defs>

  <rect x="0" y="0" width="1200" height="760" fill="#ffffff"/>
  <text x="40" y="52" class="title">Claude Code Hooks Lifecycle</text>

  <rect x="60" y="110" width="300" height="70" class="box"/>
  <text x="210" y="150" text-anchor="middle" class="label">SessionStart (startup)</text>

  <rect x="420" y="90" width="330" height="90" class="box"/>
  <text x="585" y="126" text-anchor="middle" class="label">ensure-services.sh</text>
  <text x="585" y="150" text-anchor="middle" class="sub">auto-start DCM if needed</text>

  <rect x="420" y="200" width="330" height="90" class="box"/>
  <text x="585" y="236" text-anchor="middle" class="label">track-session.sh</text>
  <text x="585" y="260" text-anchor="middle" class="sub">create session record</text>

  <line x1="360" y1="145" x2="420" y2="135" class="arrow"/>
  <line x1="360" y1="145" x2="420" y2="235" class="arrow"/>

  <rect x="60" y="280" width="300" height="70" class="box"/>
  <text x="210" y="320" text-anchor="middle" class="label">PostToolUse (*)</text>
  <rect x="420" y="270" width="330" height="90" class="box"/>
  <text x="585" y="306" text-anchor="middle" class="label">track-action.sh</text>
  <text x="585" y="330" text-anchor="middle" class="sub">POST /api/actions</text>
  <line x1="360" y1="315" x2="420" y2="315" class="arrow"/>

  <rect x="60" y="380" width="300" height="70" class="box"/>
  <text x="210" y="420" text-anchor="middle" class="label">PostToolUse (Task)</text>
  <rect x="420" y="370" width="330" height="90" class="box"/>
  <text x="585" y="406" text-anchor="middle" class="label">track-agent.sh</text>
  <text x="585" y="430" text-anchor="middle" class="sub">POST /api/subtasks</text>
  <line x1="360" y1="415" x2="420" y2="415" class="arrow"/>

  <rect x="60" y="480" width="300" height="70" class="box"/>
  <text x="210" y="520" text-anchor="middle" class="label">PostToolUse (*/10th)</text>
  <rect x="420" y="470" width="330" height="90" class="box"/>
  <text x="585" y="506" text-anchor="middle" class="label">monitor-context.sh</text>
  <text x="585" y="530" text-anchor="middle" class="sub">checks transcript size</text>
  <line x1="360" y1="515" x2="420" y2="515" class="arrow"/>

  <rect x="60" y="580" width="300" height="70" class="box"/>
  <text x="210" y="620" text-anchor="middle" class="label">PreCompact</text>
  <rect x="420" y="570" width="330" height="90" class="box"/>
  <text x="585" y="606" text-anchor="middle" class="label">pre-compact-save.sh</text>
  <text x="585" y="630" text-anchor="middle" class="sub">POST /api/compact/save</text>
  <line x1="360" y1="615" x2="420" y2="615" class="arrow"/>

  <rect x="780" y="580" width="360" height="90" class="box"/>
  <text x="960" y="616" text-anchor="middle" class="label">SessionStart (compact)</text>
  <text x="960" y="640" text-anchor="middle" class="sub">post-compact-restore.sh</text>
  <line x1="750" y1="615" x2="780" y2="615" class="arrow"/>

  <rect x="780" y="470" width="360" height="90" class="box"/>
  <text x="960" y="506" text-anchor="middle" class="label">SubagentStop</text>
  <text x="960" y="530" text-anchor="middle" class="sub">save-agent-result.sh</text>

  <rect x="780" y="370" width="360" height="90" class="box"/>
  <text x="960" y="406" text-anchor="middle" class="label">SessionEnd</text>
  <text x="960" y="430" text-anchor="middle" class="sub">track-session-end.sh</text>
</svg>
